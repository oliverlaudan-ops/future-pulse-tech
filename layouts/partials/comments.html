{{- if and .Site.Params.comments (ne .Params.comments false) -}}
<!-- Custom Comments Section mit Giscus -->
<div id="comments" class="comments-section">
  <h3>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
    </svg>
    Kommentare
  </h3>
  
  <script src="https://giscus.app/client.js"
        data-repo="oliverlaudan-ops/future-pulse-tech"
        data-repo-id="R_kgDOQ7ETsA"
        data-category="Blog Comments"
        data-category-id="DIC_kwDOQ7ETsM4C1Its"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="preferred_color_scheme"
        data-lang="de"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
  </script>
  
  <!-- Giscus Theme Switcher -->
  <script>
    // Funktion zum Aktualisieren des Giscus-Themes
    function updateGiscusTheme() {
      const theme = document.documentElement.getAttribute('data-theme') || 
                    (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
      
      const giscusTheme = theme === 'dark' ? 'dark' : 'light';
      
      // Sende Theme-Update an Giscus iFrame
      const iframe = document.querySelector('iframe.giscus-frame');
      if (iframe) {
        iframe.contentWindow.postMessage(
          { giscus: { setConfig: { theme: giscusTheme } } },
          'https://giscus.app'
        );
      }
    }
    
    // Beobachte Theme-Wechsel (PaperMod nutzt data-theme Attribut)
    const observer = new MutationObserver(updateGiscusTheme);
    observer.observe(document.documentElement, {
      attributes: true,
      attributeFilter: ['data-theme']
    });
    
    // Initial Theme setzen nach Giscus-Load
    window.addEventListener('load', () => {
      setTimeout(updateGiscusTheme, 1000); // Warte bis Giscus geladen ist
    });
    
    // Fallback: Beobachte auch theme-toggle Button-Klicks
    document.addEventListener('DOMContentLoaded', () => {
      const themeToggle = document.getElementById('theme-toggle');
      if (themeToggle) {
        themeToggle.addEventListener('click', () => {
          setTimeout(updateGiscusTheme, 100);
        });
      }
    });
  </script>
</div>
{{- end -}}
